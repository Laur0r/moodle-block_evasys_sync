define(["jquery","core/modal_factory","core/templates","core/str","core/url"],function(a,b,c,d,e){var f=function(){var b=a("[name=minute_start]").last()[0].selectedIndex,c=a("[name=hour_start]").last()[0].selectedIndex,d=a("[name=day_start]").last()[0].selectedIndex,e=a("[name=month_start]").last()[0].selectedIndex,f=a("[name=year_start]").last()[0].selectedIndex+2e3,g=a("[name=minute_end]").last()[0].selectedIndex,h=a("[name=hour_end]").last()[0].selectedIndex,i=a("[name=day_end]").last()[0].selectedIndex,j=a("[name=month_end]").last()[0].selectedIndex,k=a("[name=year_end]").last()[0].selectedIndex+2e3,l=new Date(f,e,d+1,c,b),m=new Date(k,j,i+1,h,g);return{starttime:l.getTime()/1e3,endtime:m.getTime()/1e3}},g=function(a,b){for(var c=a+"";c.length<b;)c="0"+c;return c},h=function(b){var c=a("[name=minute_"+b+"]").last()[0].selectedIndex,d=a("[name=hour_"+b+"]").last()[0].selectedIndex,e=a("[name=day_"+b+"]").last()[0].selectedIndex+1,f=a("[name=month_"+b+"]").last()[0].selectedIndex+1,h=a("[name=year_"+b+"]").last()[0].selectedIndex+2e3;return g(e,2)+"."+g(f,2)+"."+g(h,2)+" "+g(d,2)+":"+g(c,2)},i=function(){4===this.readyState&&this.status>=200&&""!=this.responseText&&require(["core/notification"],function(a){d.get_string("save_failure","block_evasys_sync").done(function(b){a.alert("Error",b,"OK")})})},j=function(g,j){var k=0;d.get_string("edit_time","block_evasys_sync").done(function(d){for(var l=!0;l;){var m=a("#timeediturl_"+k);if(m.length<=0){l=!1;break}m.on("click",function(k){var l=a(k.currentTarget);b.create({type:b.types.SAVE_CANCEL,title:d,body:c.render("block_evasys_sync/edittime",{})}).then(function(a){var b=a.getRoot();b.on("modal-save-cancel:save",function(){var a=new URL(l.prop("href")).searchParams.get("id"),b={};document.getElementById("standardtimecheck").checked&&(b=f()),b.category=a;var c=new XMLHttpRequest;c.onreadystatechange=i;var d=e.relativeUrl("/blocks/evasys_sync/alterstandardtime.php",b,!0);c.open("GET",d),c.send();var k=l.prop("id").split("_")[1];g[k]=b.starttime,j[k]=b.endtime,document.getElementById("timehint_"+k).innerHTML=h("start")+" - "+h("end")}),a.show(),require(["block_evasys_sync/initialize"],function(a){var b=l.prop("id").split("_")[1];null===g[b]||void 0===g[b]?(g[b]=Date.now()/1e3,j[b]=Date.now()/1e3):document.getElementById("standardtimecheck").checked=!0,a.init(g[b],j[b])})})}),k++}})};return{initialize:j}});