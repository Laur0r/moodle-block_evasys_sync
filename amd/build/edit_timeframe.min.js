define(["jquery","core/modal_factory","core/templates","core/str","core/url"],function(a,b,c,d,e){var f=function(){var b=a("[name=minute_start]").last()[0].selectedIndex,c=a("[name=hour_start]").last()[0].selectedIndex,d=a("[name=day_start]").last()[0].selectedIndex,e=a("[name=month_start]").last()[0].selectedIndex,f=a("[name=year_start]").last()[0].selectedIndex+2e3,g=a("[name=minute_end]").last()[0].selectedIndex,h=a("[name=hour_end]").last()[0].selectedIndex,i=a("[name=day_end]").last()[0].selectedIndex,j=a("[name=month_end]").last()[0].selectedIndex,k=a("[name=year_end]").last()[0].selectedIndex+2e3,l=new Date(f,e,d+1,c,b),m=new Date(k,j,i+1,h,g);return{starttime:l.getTime()/1e3,endtime:m.getTime()/1e3}},g=function(){4===this.readyState&&this.status>=200&&""!=this.responseText&&require(["core/notification"],function(a){d.get_string("save_failure","block_evasys_sync").done(function(b){a.alert("Error",b,"OK")})})},h=function(h,i){var j=0;d.get_string("edit_time","block_evasys_sync").done(function(k){for(var l=!0;l;){var m=a("#timeediturl_"+j);if(m.length<=0){l=!1;break}m.on("click",function(j){var l=a(j.currentTarget);b.create({type:b.types.SAVE_CANCEL,title:k,body:c.render("block_evasys_sync/edittime",{})}).then(function(b){var c=b.getRoot();c.on("modal-save-cancel:save",function(){var b=new URL(l.prop("href")).searchParams.get("id"),c={},j=a("[name=use_standardtime]").last()[0].checked;j&&(c=f()),c.category=b;var k=new XMLHttpRequest;k.onreadystatechange=g;var m=e.relativeUrl("/blocks/evasys_sync/alterstandardtime.php",c,!0);k.open("GET",m),k.send();var n=l.prop("id").split("_")[1];h[n]=c.starttime,i[n]=c.endtime,j?d.get_string("time_set","block_evasys_sync").done(function(a){document.getElementById("timehint_"+n).innerHTML=a}):document.getElementById("timehint_"+n).innerHTML=""}),b.show(),require(["block_evasys_sync/initialize"],function(b){var c=l.prop("id").split("_")[1];null===h[c]||void 0===h[c]?(h[c]=Date.now()/1e3,i[c]=Date.now()/1e3):a("[name=use_standardtime]").last()[0].checked=!0,b.init(h[c],i[c])})})}),j++}})};return{initialize:h}});