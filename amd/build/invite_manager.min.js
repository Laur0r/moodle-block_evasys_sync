define(["core/str","core/notification","core/url","jquery"],function(a,b,c,d){var e=function(a){for(var b=document.getElementById("evasys_block_form"),c=0;c<a.count;c++)b.elements["startDate"+c].value=a["startDate"+c],b.elements["endDate"+c].value=a["endDate"+c]},f=function(f){var g=new XMLHttpRequest;g.onreadystatechange=function(){if(4===this.readyState&&200===this.status)if(this.responseText.includes("/")){var c=this.responseText.split("/");if("success"===c[0]){var g={sent:c[1],total:c[2],queued:c[3]};a.get_strings([{key:"title_send_success",component:"block_evasys_sync"},{key:"content_send_success",component:"block_evasys_sync",param:g},{key:"ok"}]).done(function(a){b.alert(a[0],a[1],a[2]),e(f)})}else"warning"===c[0]?(g={sent:c[1],total:c[2],queued:c[3]},a.get_strings([{key:"title_send_invalid",component:"block_evasys_sync"},{key:"content_send_invalid",component:"block_evasys_sync"},{key:"content_send_success",component:"block_evasys_sync",param:g},{key:"ok"}]).done(function(a){b.alert(a[0],a[1]+"<br />"+a[2],a[3])})):"rejected"===c[0]?(g={sent:c[1],total:c[2],queued:c[3]},a.get_strings([{key:"title_send_rejected",component:"block_evasys_sync"},{key:"content_send_rejected",component:"block_evasys_sync"},{key:"content_send_success",component:"block_evasys_sync",param:g},{key:"ok"}]).done(function(a){b.alert(a[0],a[1]+"<br />"+a[2],a[3])})):a.get_string("send_error","block_evasys_sync").done(function(a){b.alert("Error",a,"OK")})}else"up_to_date"===this.responseText?a.get_strings([{key:"direct_title_info",component:"block_evasys_sync"},{key:"direct_already",component:"block_evasys_sync"},{key:"ok"}]).done(function(a){b.alert(a[0],a[1],a[2])}):"not_enough_dates"===this.responseText?a.get_strings([{key:"title_send_failure",component:"block_evasys_sync"},{key:"not_enough_dates",component:"block_evasys_sync"},{key:"ok"}]).done(function(a){b.alert(a[0],a[1],a[2])}):a.get_string("send_error","block_evasys_sync").done(function(a){b.alert("Error",a,"OK")});else 4===this.readyState&&a.get_string("send_error","block_evasys_sync").done(function(a){b.alert("Error",a,"OK")});4===this.readyState&&d("#evasys_block_form").find(":input[type=submit]").prop("disabled",!1)};var h=c.relativeUrl("/blocks/evasys_sync/invite.php",f,!0);g.open("GET",h),g.send()},g=function(c){var e=new Date,g=String(e.getDate()).padStart(2,"0"),h=String(e.getMonth()+1).padStart(2,"0"),i=e.getFullYear();e=i+"-"+h+"-"+g;var j=c.startDate===e;j?a.get_strings([{key:"direct_invite",component:"block_evasys_sync"},{key:"content_confirm",component:"block_evasys_sync"},{key:"yes"},{key:"no"}]).done(function(a){b.confirm(a[0],a[1],a[2],a[3],function(){f(c)},function(){d("#evasys_block_form").find(":input[type=submit]").prop("disabled",!1)})}):f(c)},h=function(){d("#evasys_block_form").submit(function(a){a.preventDefault(),d("#evasys_block_form").find(":input[type=submit]").prop("disabled",!0);var b={};d("#evasys_block_form").serializeArray().forEach(function(a){b[a.name]=a.value}),g(b)})};return{ajax:g,init:h}});